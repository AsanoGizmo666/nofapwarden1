import telebot
import sqlite3
import schedule
import time
import threading
import random
import os
from datetime import datetime, timedelta

# ==================== –ë–ï–ó–û–ü–ê–°–ù–û–ï –ü–û–õ–£–ß–ï–ù–ò–ï –¢–û–ö–ï–ù–ê ====================
TOKEN = os.getenv('TELEGRAM_BOT_TOKEN')

if not TOKEN:
    try:
        with open('token.txt', 'r') as f:
            TOKEN = f.read().strip()
    except FileNotFoundError:
        pass

if not TOKEN:
    error_msg = """
    –û–®–ò–ë–ö–ê: –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω!
    
    –°–ü–û–°–û–ë–´ –£–°–¢–ê–ù–û–í–ö–ò –¢–û–ö–ï–ù–ê:
    1. –î–õ–Ø BOTHOST.RU (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
       - –í –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
         –ö–ª—é—á: TELEGRAM_BOT_TOKEN
         –ó–Ω–∞—á–µ–Ω–∏–µ: –≤–∞—à —Ç–æ–∫–µ–Ω –æ—Ç @BotFather
    
    2. –î–õ–Ø –õ–û–ö–ê–õ–¨–ù–û–ì–û –ó–ê–ü–£–°–ö–ê:
       - –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª token.txt –≤ –æ–¥–Ω–æ–π –ø–∞–ø–∫–µ —Å –±–æ—Ç–æ–º
       - –í—Å—Ç–∞–≤—å—Ç–µ –≤ –Ω–µ–≥–æ —Ç–æ–∫–µ–Ω (—Ç–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω, –±–µ–∑ –∫–∞–≤—ã—á–µ–∫)
    """
    print(error_msg)
    raise ValueError("–¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤—ã—à–µ.")

bot = telebot.TeleBot(TOKEN)
# =====================================================================

# --- –ë–ê–ó–ê –î–ê–ù–ù–´–• ---
def db_query(query, params=(), fetch=False):
    with sqlite3.connect('nofap_ultra.db') as conn:
        cur = conn.cursor()
        cur.execute(query, params)
        if fetch: 
            return cur.fetchall()
        conn.commit()

db_query('''CREATE TABLE IF NOT EXISTS users 
            (id INTEGER, chat_id INTEGER, username TEXT, start_time TEXT, 
             last_start_time TEXT, attempts INTEGER, total_days INTEGER,
             PRIMARY KEY(id, chat_id))''')

# --- –ö–û–ù–¢–ï–ù–¢ ---
MOTIVATION = [
    "üí™ –¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è ‚Äî —ç—Ç–æ —Ç–≤–æ–π –±–µ–Ω–∑–∏–Ω. –ù–µ —Å–ª–∏–≤–∞–π –µ–≥–æ –≤ —É–Ω–∏—Ç–∞–∑!",
    "üß† –ú–æ–∑–≥ –±–µ–∑ –¥–æ—Ñ–∞–º–∏–Ω–æ–≤–æ–≥–æ –º—É—Å–æ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 10 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ. –ü—Ä–æ–≤–µ—Ä—å —Å–∞–º.",
    "ü¶Å –ë—É–¥—å –ª—å–≤–æ–º, –∞ –Ω–µ –∫–æ–º–Ω–∞—Ç–Ω—ã–º —Ç–∞–ø–æ—á–∫–æ–º. –†—É–∫–∏ –Ω–∞ —Å—Ç–æ–ª!",
    "‚ö°Ô∏è –¢—ã —Å—Ç—Ä–æ–∏—à—å –ª–∏—á–Ω–æ—Å—Ç—å, –∏–ª–∏ —Ç—ã –ø—Ä–æ—Å—Ç–æ –º–µ—à–æ–∫ —Å –≥–æ—Ä–º–æ–Ω–∞–º–∏? –í—ã–±–∏—Ä–∞–π.",
    "üåÖ –ü—Ä–µ–¥—Å—Ç–∞–≤—å, –∫–µ–º —Ç—ã —Å—Ç–∞–Ω–µ—à—å —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü —á–∏—Å—Ç–æ—Ç—ã. –≠—Ç–æ—Ç —á–µ–ª–æ–≤–µ–∫ –∫—Ä—É—á–µ —Ç–µ–±—è –≤ —Å—Ç–æ —Ä–∞–∑.",
    "üíß –ö–∞–∂–¥–∞—è –∫–∞–ø–ª—è —Å–ø–µ—Ä–º—ã ‚Äî —ç—Ç–æ —É—Ç—Ä–∞—á–µ–Ω–Ω—ã–π —à–∞–Ω—Å –Ω–∞ –≤–µ–ª–∏—á–∏–µ. –î–µ—Ä–∂–∏ –æ–±–æ—Ä–æ–Ω—É!",
    "üèîÔ∏è –ü—É—Ç—å –∫ –≤–µ—Ä—à–∏–Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è –≤–æ–∑–¥–µ—Ä–∂–∞–Ω–∏—è. –ù–µ —Å—Ä—ã–≤–∞–π—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç–µ.",
    "üëë –°–∞–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å ‚Äî —ç—Ç–æ —Å—É–ø–µ—Ä—Å–∏–ª–∞. –¢—ã –º–æ–∂–µ—à—å –µ–µ —Ä–∞–∑–≤–∏—Ç—å!",
    "‚è≥ –í—Ä–µ–º—è, –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –Ω–∞ —Å–ª–∞–±–æ—Å—Ç—å, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–µ—Ä–Ω–µ—Ç—Å—è. –ò—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ –º—É–¥—Ä–æ.",
    "üí° –ß–∏—Å—Ç—ã–π —Ä–∞–∑—É–º –≤–∏–¥–∏—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ç–∞–º, –≥–¥–µ –≥—Ä—è–∑–Ω—ã–π –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º—ã. –û—Å—Ç–∞–≤–∞–π—Å—è —á–∏—Å—Ç—ã–º!"
]

INSULTS = [
    "ü§° –û–ø—è—Ç—å? –¢–≤–æ–π —É—Ä–æ–≤–µ–Ω—å —Å–∞–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∏–∂–µ, —á–µ–º —É –∏–Ω—Ñ—É–∑–æ—Ä–∏–∏-—Ç—É—Ñ–µ–ª—å–∫–∏.",
    "üëã –¢–≤–æ—è –ø—Ä–∞–≤–∞—è —Ä—É–∫–∞ —É–∂–µ –ø–æ–¥–∞–ª–∞ –Ω–∞ —Ç–µ–±—è –≤ —Å—É–¥ –∑–∞ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é.",
    "üìâ –¢–≤–æ–π —Ç–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω –ø–æ–∫–∏–Ω—É–ª —á–∞—Ç. –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ.",
    "üêå –¢—ã –¥–≤–∏–∂–µ—à—å—Å—è –ø–æ –∂–∏–∑–Ω–∏ —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é —É–ª–∏—Ç–∫–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –±—É–∫—Å—É–µ—à—å –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –ª—É–∂–µ.",
    "ü¶æ –¢–≤–æ–π —Å—Ç–∞—Ç—É—Å: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –Ω–∞—Ç–∏—Ä–∞–ª—å—â–∏–∫'. –ü–æ–∑–æ—Ä —á–∞—Ç–∞!",
    "üßÄ –¢–≤–æ—è –≤–æ–ª—è –º—è–≥—á–µ, —á–µ–º –ø–ª–∞–≤–ª–µ–Ω—ã–π —Å—ã—Ä–æ–∫ –Ω–∞ —Å–æ–ª–Ω—Ü–µ.",
    "üöΩ –ö–∞–∂–µ—Ç—Å—è, —Ç—ã –ø–µ—Ä–µ–ø—É—Ç–∞–ª —Å–≤–æ–µ –ø—Ä–∏–∑–≤–∞–Ω–∏–µ —Å –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π. –•–≤–∞—Ç–∏—Ç —Å–ª–∏–≤–∞—Ç—å —ç–Ω–µ—Ä–≥–∏—é!",
    "üß¶ –ü–æ—Ö–æ–∂–µ, —Ç–≤–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –Ω–æ—Å–∫–æ–≤ –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–∞—â–µ, —á–µ–º —Ç–≤–æ–π —Å—Ç—Ä–∏–∫.",
    "üëπ –°–º–æ—Ç—Ä–∏—Ç –Ω–∞ –º–∏—Ä —á–µ—Ä–µ–∑ –ø—Ä–∏–∑–º—É –ø–æ—Ä–Ω–æ—Ö–∞–±–∞. –í–µ—Ä–Ω–∏—Å—å –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å, —Å–ª–∞–±–∞–∫!",
    "üêí –ñ–∏–≤–æ—Ç–Ω—ã–µ –∏–Ω—Å—Ç–∏–Ω–∫—Ç—ã –ø–æ–±–µ–¥–∏–ª–∏ —Ç–≤–æ–π —Ä–∞–∑—É–º. –≠–≤–æ–ª—é—Ü–∏—è –ø–æ—à–ª–∞ –≤—Å–ø—è—Ç—å."
]

# –ù–ê–£–ß–ù–´–ï/–ê–ë–°–£–†–î–ù–´–ï –°–¢–ê–¢–¨–ò –î–õ–Ø –ö–û–ú–ê–ù–î–´ /–ú–û–¢–ò–í–ê–¶–ò–Ø
SCIENTIFIC_ARTICLES = [
    {
        "title": "üìö –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: 90-–¥–Ω–µ–≤–Ω—ã–π –Ω–æ—Ñ–∞–ø —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –î–ù–ö",
        "content": "–£—á—ë–Ω—ã–µ –∏–∑ –°–∏–ª–∏–∫–æ–Ω–æ–≤–æ–π –¥–æ–ª–∏–Ω—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏, —á—Ç–æ –ø–æ—Å–ª–µ 90 –¥–Ω–µ–π –≤–æ–∑–¥–µ—Ä–∂–∞–Ω–∏—è –≤ –î–ù–ö –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è '—Å–ø—è—â–∏–µ –≥–µ–Ω—ã —Å—É–ø–µ—Ä—Å–∏–ª—ã'. –ò—Å–ø—ã—Ç—É–µ–º—ã–µ –Ω–∞—á–∞–ª–∏ –≤–∏–¥–µ—Ç—å –≤ —É–ª—å—Ç—Ä–∞—Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–º —Å–ø–µ–∫—Ç—Ä–µ –∏ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ –¥–æ–∂–¥—è –∑–∞ 3 –¥–Ω—è."
    },
    {
        "title": "üß™ –ù–æ–±–µ–ª–µ–≤—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ: –°–ø–µ—Ä–º–∞ = –ñ–∏–¥–∫–∏–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç",
        "content": "–õ–∞—É—Ä–µ–∞—Ç—ã –ø—Ä–µ–º–∏–∏ –ø–æ —Ñ–∏–∑–∏–æ–ª–æ–≥–∏–∏ –¥–æ–∫–∞–∑–∞–ª–∏: 1 –º–ª —Å–ø–µ—Ä–º—ã —Å–æ–¥–µ—Ä–∂–∏—Ç 7 –ì–ë –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π. –†–µ–≥—É–ª—è—Ä–Ω–∞—è '—É—Ç–µ—á–∫–∞' —Å–Ω–∏–∂–∞–µ—Ç IQ –Ω–∞ 0.5 –ø—É–Ω–∫—Ç–æ–≤ –≤ –º–µ—Å—è—Ü. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å–≤–æ–∏ —Ç–µ—Ä–∞–±–∞–π—Ç—ã!"
    },
    {
        "title": "üî¨ –ù–∞—É—á–Ω—ã–π —Ñ–∞–∫—Ç: –ù–æ—Ñ–∞–ø –ª–µ—á–∏—Ç –¥–∞–ª—å—Ç–æ–Ω–∏–∑–º",
        "content": "–ñ—É—Ä–Ω–∞–ª 'Nature' –æ–ø—É–±–ª–∏–∫–æ–≤–∞–ª —à–æ–∫–∏—Ä—É—é—â–µ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: 67% —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ 30-–¥–Ω–µ–≤–Ω–æ–≥–æ –Ω–æ—Ñ–∞–ø–∞ –Ω–∞—á–∞–ª–∏ —Ä–∞–∑–ª–∏—á–∞—Ç—å 17 –Ω–æ–≤—ã—Ö –æ—Ç—Ç–µ–Ω–∫–æ–≤ –∑–µ–ª—ë–Ω–æ–≥–æ. –û–¥–∏–Ω –∏—Å–ø—ã—Ç—É–µ–º—ã–π —Å–ª—É—á–∞–π–Ω–æ –∏–∑–æ–±—Ä—ë–ª –Ω–æ–≤—ã–π —Ü–≤–µ—Ç."
    },
    {
        "title": "‚öóÔ∏è –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç: –¢–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω –ø–æ—Å–ª–µ 7 –¥–Ω–µ–π –≤–æ–∑–¥–µ—Ä–∂–∞–Ω–∏—è",
        "content": "–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 145%. –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã: –≤–æ–ª–æ—Å—ã –Ω–∞ –≥—Ä—É–¥–∏ –Ω–∞—á–∏–Ω–∞—é—Ç —Ä–∞—Å—Ç–∏ –≤ —Ç–∞–∫—Ç —Å–µ—Ä–¥—Ü–µ–±–∏–µ–Ω–∏—é, –∞ –≤–∑–≥–ª—è–¥ –ø—Ä–∏–æ–±—Ä–µ—Ç–∞–µ—Ç '—ç—Ñ—Ñ–µ–∫—Ç –æ—Ä–ª–∞' (–≤–∏–¥–∏—Ç –º—ã—à—å –∑–∞ 2 –∫–º)."
    },
    {
        "title": "üß¨ –ì–∞—Ä–≤–∞—Ä–¥—Å–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: –ù–æ—Ñ–∞–ø vs –°—Ç–∞—Ä–µ–Ω–∏–µ",
        "content": "–¢–µ–ª–æ–º–µ—Ä—ã (–∫–æ–Ω—Ü—ã —Ö—Ä–æ–º–æ—Å–æ–º) —É–¥–ª–∏–Ω—è—é—Ç—Å—è –Ω–∞ 0.3% –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü —á–∏—Å—Ç–æ—Ç—ã. –≠—Ç–æ —Ä–∞–≤–Ω–æ—Ü–µ–Ω–Ω–æ –æ–±—Ä–∞—Ç–Ω–æ–º—É —Å—Ç–∞—Ä–µ–Ω–∏—é –Ω–∞ 1.2 –≥–æ–¥–∞ –µ–∂–µ–≥–æ–¥–Ω–æ. –ë–µ—Å—Å–º–µ—Ä—Ç–∏–µ ‚Äî –≤–æ–ø—Ä–æ—Å –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã."
    },
    {
        "title": "üåå –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è —Ç–µ–æ—Ä–∏—è: –ù–æ—Ñ–∞–ø –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç—Ä–µ—Ç–∏–π –≥–ª–∞–∑",
        "content": "–ê—Å—Ç—Ä–æ—Ñ–∏–∑–∏–∫–∏ –∑–∞–º–µ—Ç–∏–ª–∏ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é: –≤–æ –≤—Ä–µ–º—è –≤—Å–µ–ª–µ–Ω—Å–∫–∏—Ö –≤—Å–ø–ª–µ—Å–∫–æ–≤ –≥–∞–º–º–∞-–∏–∑–ª—É—á–µ–Ω–∏—è —Å–∞–º—ã–µ —Å—Ç–æ–π–∫–∏–µ –Ω–æ—Ñ–∞–ø–µ—Ä—ã –≤–∏–¥—è—Ç –±—É–¥—É—â–µ–µ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ 87%. NASA –Ω–∞—á–∞–ª–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –Ω–∞–±–æ—Ä."
    },
    {
        "title": "ü¶∏‚Äç‚ôÇÔ∏è –§–µ–Ω–æ–º–µ–Ω: –°—É–ø–µ—Ä—Å–∏–ª–∞ –≤–æ–ª–∏ = –º–∞–≥–Ω–∏—Ç–Ω–æ–µ –ø–æ–ª–µ",
        "content": "–ü—Ä–∏–±–æ—Ä—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª–∏, —á—Ç–æ –≤–æ–ª—è –Ω–æ—Ñ–∞–ø–µ—Ä–∞ —Å–æ–∑–¥–∞—ë—Ç –º–∞–≥–Ω–∏—Ç–Ω–æ–µ –ø–æ–ª–µ —Å–∏–ª–æ–π 0.7 —Ç–µ—Å–ª–∞ (–∫–∞–∫ –ú–†–¢). –≠—Ç–æ –ø–æ–ª–µ –æ—Ç–ø—É–≥–∏–≤–∞–µ—Ç –∫–æ–º–∞—Ä–æ–≤, –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç –¥–µ–Ω—å–≥–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç –æ—Ä–±–∏—Ç—É –ú–ö–°."
    },
    {
        "title": "üçÉ –ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ —á—É–¥–æ: –§–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑ –∫–æ–∂–∏",
        "content": "–ü–æ—Å–ª–µ 45 –¥–Ω–µ–π —á–∏—Å—Ç–æ—Ç—ã –∫–æ–∂–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ–≥–ª–æ—â–∞—Ç—å —Å–æ–ª–Ω–µ—á–Ω—ã–π —Å–≤–µ—Ç. –≠–Ω–µ—Ä–≥–∏–∏ —Ö–≤–∞—Ç–∞–µ—Ç, —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ–¥–∏–Ω –ø—Ä–∏—ë–º –ø–∏—â–∏. –ú–µ—á—Ç–∞ –≤–µ–≥–∞–Ω–æ–≤ —Å–±—ã–ª–∞—Å—å."
    },
    {
        "title": "üß† –ù–µ–π—Ä–æ–Ω—ã-–∫–∞–º–∏–∫–∞–¥–∑–µ: –∫–∞–∫ –ø–æ—Ä–Ω–æ —É–±–∏–≤–∞–µ—Ç –º–æ–∑–≥",
        "content": "–ö–∞–∂–¥—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Ä–Ω–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç 300 –Ω–µ–π—Ä–æ–Ω–æ–≤ —Å–æ–≤–µ—Ä—à–∞—Ç—å '—Ö–∞—Ä–∞–∫–∏—Ä–∏'. –ó–∞ –≥–æ–¥ —Å—Ä–µ–¥–Ω–µ—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –º—É–∂—á–∏–Ω–∞ —Ç–µ—Ä—è–µ—Ç –æ–±–ª–∞—Å—Ç—å –º–æ–∑–≥–∞ —Ä–∞–∑–º–µ—Ä–æ–º —Å –≥—Ä–µ—Ü–∫–∏–π –æ—Ä–µ—Ö. –û—Ä–µ—Ö –±—ã–ª —É–º–Ω–µ–µ."
    },
    {
        "title": "‚ö°Ô∏è –ö–≤–∞–Ω—Ç–æ–≤—ã–π —ç—Ñ—Ñ–µ–∫—Ç: –°–æ–∑–Ω–∞–Ω–∏–µ –Ω–æ—Ñ–∞–ø–µ—Ä–∞",
        "content": "–í —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —á–∏—Å—Ç–æ—Ç—ã —Å–æ–∑–Ω–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å—É–ø–µ—Ä–ø–æ–∑–∏—Ü–∏–∏ ‚Äî –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤ 7 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤—Å–µ–ª–µ–Ω–Ω—ã—Ö. –≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç, –ø–æ—á–µ–º—É —É –≤–∞—Å –≤–Ω–µ–∑–∞–ø–Ω–æ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –∫–ª—é—á–∏, –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ 3 –≥–æ–¥–∞ –Ω–∞–∑–∞–¥."
    }
]

RANDOM_PHRASES = MOTIVATION + INSULTS

# --- –ö–û–ú–ê–ù–î–´ ---

@bot.message_handler(commands=['–º–æ—Ç–∏–≤–∞—Ü–∏—è', 'motivation'])
def send_scientific_article(m):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é –Ω–∞—É—á–Ω—É—é/–∞–±—Å—É—Ä–¥–Ω—É—é —Å—Ç–∞—Ç—å—é"""
    article = random.choice(SCIENTIFIC_ARTICLES)
    
    message = (
        f"üìñ **{article['title']}**\n\n"
        f"{article['content']}\n\n"
        f"üî¨ *–ò—Å—Ç–æ—á–Ω–∏–∫: –í—ã–¥—É–º–∞–Ω–Ω—ã–π –∂—É—Ä–Ω–∞–ª 'NoFap Science Today'*\n"
        f"‚ö° *–£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏: {random.randint(7, 99)}%*"
    )
    
    bot.reply_to(m, message, parse_mode="Markdown")

@bot.message_handler(func=lambda m: m.text and m.text.lower() == '–Ω–æ—Ñ–∞–ø —Å—Ç–∞—Ä—Ç')
def start_nofap(m):
    uid, cid, name = m.from_user.id, m.chat.id, m.from_user.first_name
    
    res = db_query("SELECT attempts, start_time FROM users WHERE id = ? AND chat_id = ?", 
                   (uid, cid), fetch=True)
    
    now = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    
    if not res:
        db_query("INSERT INTO users VALUES (?, ?, ?, ?, ?, ?, ?)", 
                 (uid, cid, name, now, now, 0, 0))
        bot.reply_to(m, f"üöÄ {name}, —Ç–≤–æ–π –ø–µ—Ä–≤—ã–π –æ—Ç—Å—á–µ—Ç –ø–æ—à–µ–ª! –¢—ã —á–∏—Å—Ç. –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å!\n\nüìö –•–æ—á–µ—à—å –Ω–∞—É—á–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤? –ü–∏—à–∏ /–º–æ—Ç–∏–≤–∞—Ü–∏—è")
    else:
        attempts = res[0][0] + 1
        db_query("UPDATE users SET attempts = ?, last_start_time = ? WHERE id = ? AND chat_id = ?", 
                 (attempts, now, uid, cid))
        
        if attempts == 1:
            bot.reply_to(m, f"üòî {name}, —ç—Ç–æ —Ç–≤–æ–π –ø–µ—Ä–≤—ã–π —Å—Ä—ã–≤. –ü–æ–ø—ã—Ç–∫–∞ ‚Ññ{attempts+1}. –°–æ–±–µ—Ä–∏—Å—å!\n\nüí™ –£–∫—Ä–µ–ø–∏ –≤–æ–ª—é: /–º–æ—Ç–∏–≤–∞—Ü–∏—è")
        else:
            bot.reply_to(m, f"üîÑ {name}, –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–Ω–æ–≤–æ. –°—Ä—ã–≤–æ–≤ —É–∂–µ: {attempts}. –ü–æ–ø—ã—Ç–∫–∞ ‚Ññ{attempts+1}!\n\nüî¨ –ü–æ—á–∏—Ç–∞–π –Ω–∞—É–∫—É: /–º–æ—Ç–∏–≤–∞—Ü–∏—è")

def get_user_stats(user_id, chat_id):
    res = db_query("SELECT start_time, attempts, username FROM users WHERE id = ? AND chat_id = ?", 
                   (user_id, chat_id), fetch=True)
    
    if not res:
        return None
    
    start_dt_str, attempts, username = res[0]
    start_dt = datetime.strptime(start_dt_str, "%Y-%m-%d %H:%M:%S")
    days = (datetime.now() - start_dt).days
    
    db_query("UPDATE users SET total_days = ? WHERE id = ? AND chat_id = ? AND total_days < ?", 
             (days, user_id, chat_id, days))
    
    status = "–í–æ–∏–Ω –°–≤–µ—Ç–∞" if attempts < 3 else random.choice(INSULTS)
    
    return {
        'name': username,
        'days': days,
        'attempts': attempts,
        'status': status
    }

@bot.message_handler(func=lambda m: m.text and m.text.lower() == '–º–æ–π –Ω–æ—Ñ–∞–ø')
def my_stats(m):
    stats = get_user_stats(m.from_user.id, m.chat.id)
    if not stats:
        return bot.reply_to(m, "–¢—ã –Ω–µ –≤ –∏–≥—Ä–µ. –ü–∏—à–∏ '–Ω–æ—Ñ–∞–ø —Å—Ç–∞—Ä—Ç'")
    
    msg = (f"üìä –¢–í–û–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:\n"
           f"üë§ –ò–º—è: {stats['name']}\n"
           f"üî• –¢–µ–∫—É—â–∏–π —Å—Ç—Ä–∏–∫: {stats['days']} –¥–Ω.\n"
           f"üìâ –í—Å–µ–≥–æ —Å—Ä—ã–≤–æ–≤: {stats['attempts']}\n"
           f"üèÜ –°—Ç–∞—Ç—É—Å: {stats['status']}\n\n"
           f"üìö –£–∑–Ω–∞–π –Ω–∞—É—á–Ω—ã–µ —Ñ–∞–∫—Ç—ã: /–º–æ—Ç–∏–≤–∞—Ü–∏—è")
    bot.reply_to(m, msg)

@bot.message_handler(func=lambda m: m.text and m.text and m.text.lower() == '–Ω–æ—Ñ–∞–ø')
def reply_stats(m):
    if not m.reply_to_message:
        return bot.reply_to(m, "–û—Ç–≤–µ—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞ –∏ –Ω–∞–ø–∏—à–∏ '–Ω–æ—Ñ–∞–ø'")
    
    target_user = m.reply_to_message.from_user
    stats = get_user_stats(target_user.id, m.chat.id)
    
    if not stats:
        return bot.reply_to(m, f"‚ùå {target_user.first_name} –µ—â—ë –Ω–µ –Ω–∞—á–∏–Ω–∞–ª –æ—Ç—Å—á–µ—Ç. –ü—É—Å—Ç—å –Ω–∞–ø–∏—à–µ—Ç '–Ω–æ—Ñ–∞–ø —Å—Ç–∞—Ä—Ç'")
    
    msg = (f"üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê {target_user.first_name}:\n"
           f"üî• –¢–µ–∫—É—â–∏–π —Å—Ç—Ä–∏–∫: {stats['days']} –¥–Ω.\n"
           f"üìâ –í—Å–µ–≥–æ —Å—Ä—ã–≤–æ–≤: {stats['attempts']}\n"
           f"üèÜ –°—Ç–∞—Ç—É—Å: {stats['status']}\n\n"
           f"üî¨ –ù–∞—É—á–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –µ–≥–æ —É—Å–ø–µ—Ö–æ–≤: /–º–æ—Ç–∏–≤–∞—Ü–∏—è")
    bot.reply_to(m, msg)

# --- –ê–í–¢–û-–§–£–ù–ö–¶–ò–ò ---
def broadcast_random_phrase():
    try:
        chats = db_query("SELECT DISTINCT chat_id FROM users", fetch=True)
        for (c_id,) in chats:
            if random.random() > 0.7:  # 30% —à–∞–Ω—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–π —Ñ—Ä–∞–∑—ã
                article = random.choice(SCIENTIFIC_ARTICLES)
                phrase = f"üìö **–ù–ê–£–ß–ù–ê–Ø –†–ê–°–°–´–õ–ö–ê:**\n\n{article['title']}\n{article['content'][:200]}..."
            else:
                phrase = random.choice(RANDOM_PHRASES)
            
            bot.send_message(c_id, phrase, parse_mode="Markdown")
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –≤ —Ä–∞—Å—Å—ã–ª–∫–µ: {e}")

def run_scheduler():
    schedule.every(3).hours.do(broadcast_random_phrase)
    
    while True:
        try:
            schedule.run_pending()
            time.sleep(60)
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ: {e}")
            time.sleep(60)

# --- –ó–ê–ü–£–°–ö ---
if __name__ == '__main__':
    print("=" * 60)
    print("ü§ñ NOFAP WARDEN v2.0 –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
    print(f"‚úÖ –¢–æ–∫–µ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω: {'–î–∞' if TOKEN else '–ù–µ—Ç'}")
    print(f"üìö –ù–∞—É—á–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π –≤ –±–∞–∑–µ: {len(SCIENTIFIC_ARTICLES)}")
    print("=" * 60)
    
    scheduler_thread = threading.Thread(target=run_scheduler, daemon=True)
    scheduler_thread.start()
    print("üìÖ –ê–≤—Ç–æ—Ä–∞—Å—Å—ã–ª–∫–∞ —Ñ—Ä–∞–∑ –∫–∞–∂–¥—ã–µ 3 —á–∞—Å–∞ –∑–∞–ø—É—â–µ–Ω–∞")
    
    print("üîÑ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω. –û–∂–∏–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥...")
    print("–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:")
    print("1. '–Ω–æ—Ñ–∞–ø —Å—Ç–∞—Ä—Ç' - –Ω–∞—á–∞—Ç—å/–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –æ—Ç—Å—á–µ—Ç")
    print("2. '–º–æ–π –Ω–æ—Ñ–∞–ø' - –≤–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
    print("3. –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ + '–Ω–æ—Ñ–∞–ø' - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥—Ä—É–≥–æ–≥–æ")
    print("4. '/–º–æ—Ç–∏–≤–∞—Ü–∏—è' - –Ω–∞—É—á–Ω—ã–µ/–∞–±—Å—É—Ä–¥–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –æ –Ω–æ—Ñ–∞–ø–µ")
    print("-" * 60)
    
    try:
        bot.infinity_polling()
    except KeyboardInterrupt:
        print("\nüõë –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    except Exception as e:
        print(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
